BOB â€“ Master Handoff (v3.1.1 â†’ v3.4 Roadmap)

Owner: Jim Donnelly
Date: September 1, 2025
Audience: Development AI / Code Review Agent (â€œAOâ€)
Purpose: Authoritative requirements + defect log for BOB app, covering current state (v3.1.1) and next milestone (v3.4).

â¸»

1) Executive Context

The BOB App is a Firebase Firestoreâ€“based productivity platform for managing Goals â†’ Stories â†’ Tasks, sprints, habits, calendar blocks, integrations, and routines.
	â€¢	v3.0.7 baseline delivered Sprint Planner (2-D matrix), Pragmatic DnD, Theme colour inheritance.
	â€¢	v3.0.8 introduced regressions (entities not surfacing, side-panels gone).
	â€¢	v3.1.0 included Global Activity Stream + UI Tracking.
	â€¢	v3.1.1 fixes P1 issues, adds Enhanced Logging, Calendar UI foundation, Routines/Chores.
	â€¢	v3.4 introduces the Goal Visualization view (roadmap-style timeline), with CRUD parity for Goals, Stories, Tasks, Sprints.

â¸»

2) Versioning
	â€¢	App version: v3.1.1
	â€¢	This document: Master Handoff (v3.1.1 baseline + v3.4 roadmap)

â¸»

3) Runtime Observations (v3.1.1)
	â€¢	Global Activity Stream and UI Tracking active.
	â€¢	Sprint listener returning data but throwing missing index error and duplicating listeners.
	â€¢	Auth listener functional (user: donnelly.jim@gmail.com).

â¸»

4) ðŸ”´ P1 Defects (Blockers, v3.1.1)

0. Activity Stream write failing (console flood)

Symptoms
	â€¢	Repeating Firestore errors:
â€œFailed to track view: FirebaseError: Function addDoc() called with invalid data. Unsupported field value: undefined (found in field referenceNumber in document activity_stream/â€¦)â€
	â€¢	Example context: entityType=goal, entityTitle=â€œRun an Iron Manâ€.

Impact
	â€¢	Activity entries not saved.
	â€¢	Console flooded, masking other issues.
	â€¢	Global Activity Stream unreliable.

Root cause
	â€¢	Activity payload includes referenceNumber: undefined.
	â€¢	Schema/spec standardises on ref, but some tracking code still uses referenceNumber.
	â€¢	No validation or fallback before addDoc.

Immediate fixes
	â€¢	Guard: if referenceNumber undefined, populate from entity.ref.
	â€¢	If ref missing, fallback to â€œGOAL-â€.
	â€¢	Align schema to use ref as canonical, dual-write referenceNumber=ref for now.
	â€¢	Validate payload before addDoc.
	â€¢	Throttle duplicate console logs.

Structural fixes
	â€¢	Shared activity builder utility to normalise: { ref, entityId, entityType, entityTitle, action, metadata, ts }.
	â€¢	Add schema validation (e.g., zod).
	â€¢	Add tests for missing ref/referenceNumber.

Acceptance criteria
	â€¢	Viewing Goal/Story/Task produces exactly one valid activity_stream entry.
	â€¢	No console flood.
	â€¢	All activity docs contain a valid ref.

â¸»

1. Boards & Tables not syncing with DB
	â€¢	Entities exist in Firestore but not visible in tables, Kanban, or Planner.

2. Side-panel editing missing
	â€¢	CRUD side-panel for Goals/Stories/Tasks has disappeared.

3. Ref numbers not displayed
	â€¢	GOAL-###, STRY-###, TASK-### missing in list rows/cards/side-panels.

4. Sprint loading spinner stuck
	â€¢	Runtime logs confirm missing Firestore index + duplicate listeners.
	â€¢	Causes infinite loading state.

5. Cannot add Stories to Goals
	â€¢	Creating a Story under a Goal fails silently, goalId linkage missing.

6. Notes not persisting/rendering
	â€¢	Writes succeed? UI fails to show notes. Example payload:
{ â€œitemIdâ€: â€œppYk7ciyaphZUnzJSIUeâ€, â€œitemTypeâ€: â€œtaskâ€, â€œnoteâ€: â€œblahâ€, â€œuserIdâ€: â€œCdmmvv8BhWMF2CvUgoNzQfxtGx62â€, â€œuserEmailâ€: â€œdonnelly.jim@gmail.comâ€, â€œreferenceNumberâ€: â€œTK-PPYK7Câ€ }

7. Inline tracking â€œEnterâ€ does not save
	â€¢	Must commit immediately to Firestore, not just on blur.

â¸»

5) ðŸŸ¡ P2 Issues
	â€¢	DnD persistence inconsistent (ranks lost after refresh).
	â€¢	Planner row expansion not persisted.
	â€¢	Theme colour cascade incomplete.
	â€¢	Listener error handling inadequate.

â¸»

6) ðŸŸ¢ P3 Issues
	â€¢	Accessibility gaps (Planner keyboard flows, screen-reader).
	â€¢	Undo toast missing in Goals/Tasks tables.
	â€¢	Logs not surfaced clearly in UI.

â¸»

7) Priority Requirements (Consolidated, v3.1.1)
	â€¢	Sprint Planner (2-D matrix)
	â€¢	Current Sprint Kanban
	â€¢	Calendar Blocking & AI Scheduling (Google Calendar sync + GCal-style grid UI)
	â€¢	Daily LLM Digest
	â€¢	Health & Nutrition integrations (Strava, Runna, MyFitnessPal)
	â€¢	iOS Reminders sync
	â€¢	Mobile â€œImportant Nowâ€
	â€¢	Selenium CI + side-door auth
	â€¢	Theme colour inheritance
	â€¢	Pragmatic Drag & Drop refactor
	â€¢	Enhanced Logging & Telemetry (?debug=db)
	â€¢	Routines & Chores (recurring lists, streaks, optional blocks)

â¸»

8) Schema Deltas (v3.1.1)
	â€¢	Stories: ref, goalId, subGoalId?, sprintId?, rank fields, themeId
	â€¢	Tasks: importanceScore, isImportant, reminderId, rank
	â€¢	Sprints: ref, objective, status, rank
	â€¢	Calendar Blocks: storyId?, habitId?, subTheme?, googleEventId?, themeId, conflictVersion
	â€¢	Theme Settings: per-user, defaultThemeId, highContrastMode
	â€¢	UI State: plannerRowExpansion, plannerVisibleSprints
	â€¢	Sub-goals: id, goalId, title, rank
	â€¢	Routines: routines, routine_items, routine_logs
	â€¢	Audit Logs (staging)

â¸»

9) Developer Tasks (v3.1.1)
	1.	Fix activity_stream write failures (referenceNumber/ref mismatch).
	2.	Fix Firestore listeners for Goals/Stories/Tasks.
	3.	Reinstate side-panel CRUD.
	4.	Render refs everywhere.
	5.	Fix sprint loading (indexes, listener lifecycle).
	6.	Fix Story creation under Goals.
	7.	Implement Enter-to-save globally.
	8.	Fix notes persistence/rendering.
	9.	Wire Enhanced Logging.
	10.	Expand tests.

â¸»

10) New Requirements for v3.4 (Goal Visualization & CRUD)

10.1 CRUD Baseline
	â€¢	Full CRUD for Goals, Stories, Tasks, Sprints across card + table views.
	â€¢	Inline editing consistent across tables.

10.2 Goal Visualization View
	â€¢	Roadmap-style timeline (calendar + sprint markers).
	â€¢	Goal cards with start/end bars, theme colour-coded.
	â€¢	Stories/Tasks tables beneath each Goal.
	â€¢	Drag Goals â†’ update dates & cascade sprint assignments.
	â€¢	Confirmation modal if >2 Stories move.
	â€¢	Drag Stories individually.

10.3 Activity Stream
	â€¢	Log all Goal/Story/Task updates, sprint reassignments, comments.

10.4 Sharing & Export
	â€¢	Accessible from nav.
	â€¢	Printable (A3 horizontal).
	â€¢	Shareable read-only link with filters.

10.5 Performance
	â€¢	Handle 100+ Goals across 6+ themes.
	â€¢	Load <3s, drag-drop <200ms.

âž¡ See goals_visualization.md for module details.

â¸»

11) Schema Enhancements (v3.4)
	â€¢	Goals: add startDate, endDate, themeId.
	â€¢	Stories: add plannedSprintId.
	â€¢	Activity Stream: add fieldUpdate, comment.
	â€¢	Visualization State: { zoomLevel, visibleThemes[], collapsedGoals[] }.

â¸»

12) Developer Tasks (v3.4)
	1.	CRUD parity across card/table views.
	2.	Build Goal Visualization (timeline grid + sprint overlay).
	3.	Implement confirmation logic.
	4.	Expand Activity Stream.
	5.	Add print/export/share link.
	6.	Optimize performance.

â¸»

13) Testing & CI
	â€¢	Unit: activity payload validation, date â†’ sprint recalculation.
	â€¢	Integration: confirmation modal triggers; Story moves cascade correctly.
	â€¢	E2E: CRUD reflected in visualization; inline save works; share link loads.
	â€¢	Perf: 100+ Goals load <3s; drag-drop <200ms.
	â€¢	A11y: keyboard timeline nav, screen-reader labels.

â¸»

14) AO Prompt

Review v3.1.1 codebase. Fix P1 defects first:
	â€¢	Activity stream write failures (referenceNumber undefined).
	â€¢	Boards/tables not syncing.
	â€¢	Side-panel missing.
	â€¢	Ref numbers not shown.
	â€¢	Sprint spinner (index + duplicate listeners).
	â€¢	Story creation under Goals.
	â€¢	Notes not persisting.
	â€¢	Enter-to-save.

Then implement v3.4 requirements: CRUD parity + Goal Visualization (timeline, sprint overlays, confirmation modal, Activity Stream logging, share/print). Ensure performance and accessibility. Deliver updated schema, code, and tests.

â¸»

15) Conclusion

This document is the single source of truth for the BOB App moving from v3.1.1 to v3.4.
	â€¢	Captures all current defects, including the Activity Stream referenceNumber failure.
	â€¢	Defines CRUD + Visualization requirements.
	â€¢	Aligns schema, developer tasks, and testing.
	â€¢	Ready for AO/code review agent to reconcile and implement.
